<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WhisPTT · Money Penny</title>
  <link rel="stylesheet" href="assets/css/theme.css">
</head>
<body>
  <div class="app-shell app-shell--construction">
    <header class="top-banner"><img src="assets/html-logo-images/whisptt-logo-corners-tinted.png" alt="WhisPTT logo" class="top-banner__logo"></header>

    <main class="screen">
      <section class="transcription-panel" aria-label="Money Penny agent console">
        <div class="status-bar">
          <span class="timer status-bar__timer">MONEY PENNY</span>
        </div>
        <div class="agent-panel" aria-live="polite">
          <p class="agent-panel__blurb">
            Paste a job description or high-level notes and Money Penny will help draft custom resume bullets,
            cover letters, or first-contact emails for potential employers.
          </p>
          <label class="agent-panel__label" for="agent-input">Job description / context</label>
          <textarea id="agent-input" class="agent-textarea" placeholder="Paste the job description or key notes here..."></textarea>

          <label class="agent-panel__label" for="agent-instructions">What do you need?</label>
          <textarea id="agent-instructions" class="agent-textarea agent-textarea--small" placeholder="e.g. Draft a short cover letter that highlights my product marketing background."></textarea>

          <div class="agent-panel__actions">
            <button type="button" class="agent-button" id="agent-run">Ask Money Penny</button>
            <button type="button" class="agent-button agent-button--ghost" id="agent-clear">Clear</button>
          </div>
          <p class="agent-status-text" id="agent-status" role="status"></p>
          <div class="agent-output" id="agent-output">
            <p class="agent-output__placeholder">Drafts will appear here.</p>
          </div>
        </div>
      </section>
    </main>

    <nav class="bottom-nav" aria-label="Primary navigation">
      <button class="bottom-nav__item" type="button" aria-label="Chat" id="nav-chat">
        <img src="assets/lower-menu-svg-icons/L2-chat-menu.svg" alt="Chat" class="bottom-nav__icon">
      </button>
      <button class="bottom-nav__item" type="button" aria-label="Profile" id="nav-profile">
        <img src="assets/lower-menu-svg-icons/L1-profile-page-menu.svg" alt="Profile" class="bottom-nav__icon">
      </button>
      <button class="bottom-nav__item" type="button" aria-label="Recorder" id="nav-recorder">
        <img src="assets/lower-menu-svg-icons/C-mic-center-menu.svg" alt="Recorder" class="bottom-nav__icon">
      </button>
      <button class="bottom-nav__item" type="button" aria-label="Edit Transcript" id="nav-editor">
        <img src="assets/lower-menu-svg-icons/R1-edit-transcript-menu.svg" alt="Edit Transcript" class="bottom-nav__icon">
      </button>
      <button class="bottom-nav__item bottom-nav__item--active" type="button" aria-label="Android" id="nav-android">
        <img src="assets/lower-menu-svg-icons/R2-android-menu.svg" alt="Android" class="bottom-nav__icon">
      </button>
    </nav>
  </div>

  <script>
    (function () {
      const API_BASE = window.location.origin.includes('localhost') || window.location.origin.includes('127.0.0.1')
        ? "http://127.0.0.1:7000"
        : (window.API_BASE_URL || "http://127.0.0.1:7000");

      const navRecorderButton = document.getElementById('nav-recorder');
      const navEditorButton = document.getElementById('nav-editor');
      const navAndroidButton = document.getElementById('nav-android');
      const navChatButton = document.getElementById('nav-chat');
      const navProfileButton = document.getElementById('nav-profile');
      const runButton = document.getElementById('agent-run');
      const clearButton = document.getElementById('agent-clear');
      const inputField = document.getElementById('agent-input');
      const instructionField = document.getElementById('agent-instructions');
      const statusNode = document.getElementById('agent-status');
      const outputNode = document.getElementById('agent-output');

      const go = (path) => {
        window.location.href = path;
      };

      if (navRecorderButton) {
        navRecorderButton.addEventListener('click', () => go('html_redline.html'));
      }
      if (navEditorButton) {
        navEditorButton.addEventListener('click', () => go('html_editor.html'));
      }
      if (navAndroidButton) {
        navAndroidButton.addEventListener('click', () => go('html_android.html'));
      }
      if (navChatButton) {
        navChatButton.addEventListener('click', () => go('html_chat.html'));
      }
      if (navProfileButton) {
        navProfileButton.addEventListener('click', () => go('html_profile.html'));
      }

      const setStatus = (text, tone) => {
        statusNode.textContent = text || '';
        statusNode.className = 'agent-status-text';
        if (tone) {
          statusNode.classList.add(`agent-status-text--${tone}`);
        }
      };

      const renderOutput = (content) => {
        outputNode.innerHTML = '';
        if (!content) {
          const placeholder = document.createElement('p');
          placeholder.className = 'agent-output__placeholder';
          placeholder.textContent = 'Drafts will appear here.';
          outputNode.appendChild(placeholder);
          return;
        }
        const paragraph = document.createElement('p');
        paragraph.className = 'agent-output__body';
        paragraph.textContent = content.trim();
        outputNode.appendChild(paragraph);
        outputNode.scrollTop = 0;
      };

      if (clearButton) {
        clearButton.addEventListener('click', () => {
          inputField.value = '';
          instructionField.value = '';
          renderOutput('');
          setStatus('');
          inputField.focus();
        });
      }

      if (runButton) {
        runButton.addEventListener('click', async () => {
          const context = inputField.value.trim();
          const task = instructionField.value.trim() || 'Draft a concise outreach message.';

          if (!context) {
            setStatus('Please paste a job description or notes first.', 'warn');
            inputField.focus();
            return;
          }

          setStatus('Asking Money Penny…', 'info');
          renderOutput('');
          runButton.disabled = true;
          try {
            const response = await fetch(`${API_BASE}/api/agent/moneypenny`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: `${context}\n\nRequest: ${task}` }),
            });
            if (!response.ok) {
              const detail = await response.json().catch(() => ({}));
              throw new Error(detail?.detail || `Request failed (${response.status})`);
            }
            const payload = await response.json();
            renderOutput(payload.output);
            setStatus('Draft ready.', 'success');
          } catch (error) {
            console.warn('Agent request failed', error);
            setStatus(String(error.message || error), 'error');
          } finally {
            runButton.disabled = false;
          }
        });
      }
    })();
  </script>
</body>
</html>

